<div class="members-container">
  <div class="members-header">
    <h2>Gestion des Ã‰quipe</h2>
    <button class="btn-add-member" (click)="openAddMemberDialog()">+ Ajouter un membre</button>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon" style="background-color: #f3f3f3;">ğŸ‘¥</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats().total }}</div>
        <div class="stat-label">Total des membres</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="background-color: #f44336; color: white;">âš™ï¸</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats().admins }}</div>
        <div class="stat-label">Administrateurs</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="background-color: #2196f3; color: white;">ğŸ“¦</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats().stockManagers }}</div>
        <div class="stat-label">Gestionnaires de stock</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="background-color: #4caf50; color: white;">ğŸ”¨</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats().operators }}</div>
        <div class="stat-label">OpÃ©rateurs</div>
      </div>
    </div>
  </div>

  <!-- Add/Edit Member Modal -->
  @if (showDialog()) {
    <div class="modal-overlay" (click)="closeDialog()">
      <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ dialogMode() === 'add' ? 'Ajouter un membre' : 'Modifier le membre' }}</h3>
          <button type="button" class="btn-close" (click)="closeDialog()">Ã—</button>
        </div>
        @if (errorMessage()) {
          <div class="error-banner">{{ errorMessage() }}</div>
        }
        <form class="modal-form" (ngSubmit)="saveMember()">
          <div class="form-row">
            <div class="form-group">
              <label>PrÃ©nom *</label>
              <input type="text" [(ngModel)]="formData.prenom" name="prenom" class="form-input" required>
            </div>
            <div class="form-group">
              <label>Nom *</label>
              <input type="text" [(ngModel)]="formData.nom" name="nom" class="form-input" required>
            </div>
          </div>
          <div class="form-group">
            <label>Email *</label>
            <input type="email" [(ngModel)]="formData.email" name="email" class="form-input" [readonly]="dialogMode() === 'edit'" required>
          </div>
          <div class="form-group" *ngIf="dialogMode() === 'add'">
            <label>Mot de passe *</label>
            <input type="password" [(ngModel)]="formData.password" name="password" class="form-input" required placeholder="DÃ©finir un mot de passe">
          </div>
          <div class="form-group" *ngIf="dialogMode() === 'edit'">
            <label>Nouveau mot de passe (laisser vide pour ne pas changer)</label>
            <input type="password" [(ngModel)]="formData.password" name="passwordEdit" class="form-input" placeholder="Optionnel">
          </div>
          <div class="form-group">
            <label>RÃ´le</label>
            <select [(ngModel)]="formData.role" name="role" class="form-select">
              <option value="admin">Administrateur</option>
              <option value="gestionnaire_de_stock">Gestionnaire de stock</option>
              <option value="operateur">OpÃ©rateur</option>
            </select>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-cancel" (click)="closeDialog()">Annuler</button>
            <button type="submit" class="btn-save" [disabled]="saving()">
              {{ saving() ? 'Enregistrement...' : (dialogMode() === 'add' ? 'CrÃ©er' : 'Mettre Ã  jour') }}
            </button>
          </div>
        </form>
      </div>
    </div>
  }

  <!-- Members Table -->
  <div class="members-table">
    <table>
      <thead>
        <tr>
          <th>Nom</th>
          <th>Email</th>
          <th>RÃ´le</th>
          <th>Statut</th>
          <th>DerniÃ¨re connexion</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let member of members(); trackBy: trackByMemberId" [class.inactive]="member.status === 'inactive'">
          <td>
            <div class="member-info">
              <div class="member-avatar-initials">{{ member.prenom.charAt(0) || '' }}{{ member.nom.charAt(0) || '' }}</div>
              <div>
                <div class="member-name">{{ member.prenom }} {{ member.nom }}</div>
              </div>
            </div>
          </td>
          <td>{{ member.email }}</td>
          <td>
            <span class="role-badge" [style.backgroundColor]="getRoleColor(member.role)">
              {{ getRoleLabel(member.role) }}
            </span>
          </td>
          <td>
            <span class="status-badge" [class.active]="member.status === 'active'" [class.inactive]="member.status === 'inactive'">
              {{ member.status === 'active' ? 'Actif' : 'Inactif' }}
            </span>
          </td>
          <td>{{ (member.lastLogin | date: 'short') || 'Jamais' }}</td>
          <td>
            <div class="actions">
              <button class="btn-icon" title="Modifier" (click)="editMember(member)">âœ</button>
              <button class="btn-icon" title="Changer le rÃ´le" (click)="openRoleDialog(member)">ğŸ”„</button>
              <button class="btn-icon" title="Basculer le statut" (click)="toggleStatus(member)">ğŸ‘ï¸</button>
              <button class="btn-icon delete" title="Supprimer" (click)="deleteMember(member)">ğŸ—‘ï¸</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
